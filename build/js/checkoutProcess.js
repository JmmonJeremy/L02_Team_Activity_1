var h=(o,e,t)=>new Promise((n,s)=>{var a=i=>{try{r(t.next(i))}catch(c){s(c)}},m=i=>{try{r(t.throw(i))}catch(c){s(c)}},r=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,m);r((t=t.apply(o,e)).next())});import{getLocalStorage as l,setLocalStorage as d,alertMessage as u,removeAllAlerts as g}from"./utils.js";import p from"./externalServices.js";const x=new p;function f(o){const e=new FormData(o),t={};return e.forEach(function(n,s){t[s]=n}),t}function C(o){const e=o.map(t=>({id:t.Id,name:t.Name,price:t.FinalPrice,quantity:t.Count}));return e}export default class I{constructor(e,t){this.cart=e,this.formElement=t,this.itemsCount=0,this.itemsCost=0,this.cartItems=[],this.shipping=0,this.tax=0,this.grandTotal=0}init(){this.cartItems=l("so-cart"),this.itemsSubtotal()}itemsSubtotal(){this.cartItems.forEach(e=>{this.itemsCount+=e.Count,this.itemsCost+=e.FinalPrice*e.Count}),document.getElementById("subtotal").innerText=this.itemsCount,document.getElementById("itemsBalance").innerHTML=this.itemsCost.toFixed(2)}additionsTotal(){this.shipping=10+this.itemsCount*2,this.tax=this.itemsCost*.06,this.grandTotal=this.itemsCost+this.shipping+this.tax,document.getElementById("shippingBalance").innerText="$"+this.shipping.toFixed(2),document.getElementById("taxBalance").textContent="$"+this.tax.toFixed(2),document.getElementById("totalBalance").innerHTML="$"+this.grandTotal.toFixed(2)}checkout(){return h(this,null,function*(){const e=document.forms.checkout,t=f(e);t.orderDate=new Date,t.orderTotal=this.grandTotal,t.shipping=this.shipping,t.tax=this.tax,t.items=C(this.cartItems);try{const n=yield x.checkout(t);d("so-cart",[]),window.location.href="checkedout.html"}catch(n){g();let s=yield n.message;for(let a in s)u(s[a],"main-header")}})}}
