var m=(h,e,t)=>new Promise((r,o)=>{var n=s=>{try{i(t.next(s))}catch(d){o(d)}},c=s=>{try{i(t.throw(s))}catch(d){o(d)}},i=s=>s.done?r(s.value):Promise.resolve(s.value).then(n,c);i((t=t.apply(h,e)).next())});import{getLocalStorage as p,setLocalStorage as g,alertMessage as C}from"./utils.js";import{displayCart as L}from"./cart-superscript.js";import{loadHeaderFooter as S,loadTemplate as y,renderListWithTemplate as _}from"./utils.js";export default class T{constructor(e,t){this.productId=e,this.product={},this.dataSource=t,this.postedComments=document.getElementById("posted-comments"),this.commentsList=[]}init(){return m(this,null,function*(){this.product=yield this.dataSource.findProductById(this.productId),this.renderProductDetails(),document.querySelector(".product-breadcrumb").innerHTML=`${this.product.Category.charAt(0).toUpperCase()+this.product.Category.slice(1)}`;let e=`../product-listing?category=${this.product.Category}`;document.querySelector(".product-breadcrumb").href=e;let t=document.getElementById("addToCart");t.addEventListener("click",()=>{this.addToCart(this);let r=document.getElementsByClassName("cart")[0];r.setAttribute("id","resize__icon");function o(){r.setAttribute("id","cart__icon")}setTimeout(o,4e3),t.className="enlarge";function n(){t.className="resume"}setTimeout(n,250)}),this.addProductComment()})}addProductComment(){const e=document.querySelector("#comment-section"),t=document.createElement("div");t.id="comment-bttn-box",t.innerHTML=`&nbsp;<span id="red-x"
     >X</span><b id="comment-label">&nbsp; Add Comment: </b>&nbsp;
     <p class="comment-line" contenteditable="true"></p>
     <button type='button' id='postComment'>Post</button>
     <button type='button' id='deleteComment'>Clear</button>
     `;let r="No button yet",o="No button yet",n="No button yet",c="No comment line yet";const i=document.getElementById("comment");i.addEventListener("click",()=>{e.appendChild(t),window.scrollTo(0,document.body.scrollHeight),this.postedComments.childElementCount==0&&(this.postedComments.className="noLine"),r=document.getElementById("red-x"),r.addEventListener("click",()=>{t.remove()}),c=document.querySelector(".comment-line"),o=document.getElementById("deleteComment"),o.addEventListener("click",()=>{c.innerHTML=""}),n=document.getElementById("postComment"),n.addEventListener("click",()=>{if(c.innerText!==""){let s=c.innerText,d="<B>&nbsp; Comment #"+(parseInt(this.postedComments.childElementCount)+1)+": </b>",l=d.concat(s);this.postedComments.innerHTML+=`<p>${l}</p>`,c.innerHTML="",t.remove(),this.postedComments.className="topLine";const u=document.querySelector("h2.divider").innerHTML;let a=p("comments for: "+u);Array.isArray(a)&&(this.commentsList=a),this.commentsList.push(l),g("comments for: "+u,this.commentsList)}})})}addToCart(){let e=p("so-cart");e==null&&(e=[]),e.length!=0&&e.forEach(t=>{t.Id==this.product.Id&&(t.InCart=!0,this.product.InCart=!0,t.Count++)}),this.product.InCart||(this.product.Count++,e.push(this.product)),g("so-cart",e),L(),C("Item added to Cart! ","added-item")}renderProductDetails(){let e=document.querySelector(".product-detail>h3"),t=document.querySelector(".product-detail>h2"),r=document.querySelector(".discount-flag"),o=document.querySelector(".flag-percent"),n=document.querySelector(".price-highlight"),c=document.querySelector(".product-card__orginal-price"),i=document.querySelector(".product-card__discount"),s=document.querySelector(".color__pick"),d=document.querySelector(".product__description");e.innerHTML=this.product.Brand.Name,t.innerHTML=this.product.NameWithoutBrand,r.alt="discount flag star",r.src="../images/discount.svg",o.innerHTML=100-Math.ceil(this.product.ListPrice/this.product.SuggestedRetailPrice*100),c.innerHTML+=this.product.SuggestedRetailPrice.toFixed(2),i.innerHTML+=(this.product.SuggestedRetailPrice-this.product.ListPrice).toFixed(2)+"!!!",n.innerHTML+=this.product.ListPrice,this.renderProductColors(this.product.Colors,s),this.renderProductImages(this.product.Images),d.innerHTML+=this.product.DescriptionHtmlSimple,document.getElementById("addToCart").setAttribute("data-id",this.product.Id);const l=document.querySelector("h2.divider").innerHTML;let u=p("comments for: "+l);Array.isArray(u)&&(this.commentsList=u,this.postedComments.className="topLine"),this.commentsList.forEach(a=>{this.postedComments.innerHTML+=`<p>${a}</p>`})}renderProductImages(e){return m(this,null,function*(){let t=document.querySelector("img#product-img"),r=document.querySelector(".carousel__viewport");if(e.ExtraImages==null){r.parentNode.style.display="none",t.setAttribute("alt",this.product.NameWithoutBrand),t.setAttribute("src",this.product.Images.PrimaryLarge);return}t.style.display="none";const o=yield y("../partials/product-img-carrousel-template.html"),n={Title:e.NameWithoutBrand,Src:e.PrimaryLarge};let c=[n].concat(e.ExtraImages);_(o,r,c,this.prepareImages)})}prepareImages(e,t){const r=e.querySelector("img"),o=e.querySelector("a.carousel__prev"),n=e.querySelector("a.carousel__next"),c=document.querySelectorAll(".carousel__viewport li"),i=c.length+1,s=e.querySelector("#carousel__slide_0");return s.setAttribute("id",`carousel__slide${i}`),o.href=`#carousel__slide${i-1}`,n.href="#carousel__slide1",r.src=t.Src,r.alt=t.Title,i==1||(c[0].querySelector(".carousel__slide a.carousel__prev").href=`#carousel__slide${i}`,c[i-2].querySelector(".carousel__slide a.carousel__next").href=`#carousel__slide${i}`),e}renderProductColors(e,t){return m(this,null,function*(){t.innerHTML="";const r=yield y("../partials/product-color-item-template.html");_(r,t,e,this.prepareTemplate)})}prepareTemplate(e,t){const r=e.querySelector("img");return r.src=t.ColorChipImageSrc,r.alt=t.ColorName,r.onclick=()=>{let o=document.querySelector("img#product-img");o.src=t.ColorPreviewImageSrc},e}addComment(){const e=document.querySelector(".product-detail")}}S();
